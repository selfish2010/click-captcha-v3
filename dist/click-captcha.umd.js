(function(n,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n.ClickCaptcha={},n.Vue))})(this,function(n,e){"use strict";const g="",h=(t,c)=>{const i=t.__vccOpts||t;for(const[a,s]of c)i[a]=s;return i},d={name:"ClickCaptcha",props:{showCaptcha:{type:Boolean,default:!1},sourceUrl:{type:String,default:""}},watch:{showCaptcha(t,c){t&&this.loadNewCaptcha()}},data(){return{sourceLoading:!0,source:{base64:"",text:[],width:"",height:""},selectedPoints:[]}},computed:{containerStyle(){return{width:`${this.source.width}px`,height:`${this.source.height}px`}}},methods:{handleImageClick(t){if(this.selectedPoints.length>=this.source.text.length)return;const c=t.currentTarget.getBoundingClientRect(),i=t.clientX-c.left,a=t.clientY-c.top;if(this.selectedPoints.push(i+","+a),this.selectedPoints.length>=this.source.text.length){let s=[this.selectedPoints.join("-"),this.source.width,this.source.height].join(";");this.$emit("point-selected",s)}},refreshCaptcha(){this.selectedPoints=[],this.loadNewCaptcha()},async loadNewCaptcha(){this.sourceLoading=!0,fetch(this.sourceUrl,{method:"POST",headers:{"Content-Type":"application/json"}}).then(t=>t.json()).then(t=>{this.source=t.data}).finally(()=>{setTimeout(()=>{this.sourceLoading=!1},500)})},close(){this.$emit("close")}}},p={key:0,class:"source-loading"},f={class:"captcha-bottom"},m={key:0,class:"captcha-tip"};function k(t,c,i,a,s,l){return e.withDirectives((e.openBlock(),e.createElementBlock("div",{class:"captcha-layer",onClick:c[2]||(c[2]=(...o)=>l.close&&l.close(...o))},[e.createElementVNode("div",{class:"click-captcha",style:e.normalizeStyle(l.containerStyle),onClick:e.withModifiers(()=>!1,["stop"])},[e.createElementVNode("div",{class:"captcha-image",style:e.normalizeStyle({backgroundImage:`url(${s.source.base64})`,cursor:"pointer"}),onClick:c[0]||(c[0]=(...o)=>l.handleImageClick&&l.handleImageClick(...o))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.selectedPoints,(o,C)=>(e.openBlock(),e.createElementBlock("div",{key:C,class:"captcha-point",style:e.normalizeStyle(`left:${o.split(",")[0]-2}px;top:${o.split(",")[1]-2}px`)},null,4))),128))],4),s.sourceLoading?(e.openBlock(),e.createElementBlock("div",p,"加载中")):e.createCommentVNode("",!0),e.createElementVNode("div",f,[s.source.text.length>0?(e.openBlock(),e.createElementBlock("div",m,[c[3]||(c[3]=e.createTextVNode("请点击图片中的: ",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.source.text,o=>(e.openBlock(),e.createElementBlock("span",{key:o}," <"+e.toDisplayString(o)+"> ",1))),128))])):e.createCommentVNode("",!0),e.createElementVNode("div",{class:"captcha-refresh",onClick:c[1]||(c[1]=(...o)=>l.refreshCaptcha&&l.refreshCaptcha(...o))}," 刷新 ")])],4)],512)),[[e.vShow,i.showCaptcha]])}const r=h(d,[["render",k],["__scopeId","data-v-6b3f7f8c"]]),u={install(t,c={}){t.component("ClickCaptchaV3",r)}};n.ClickCaptchaV3=r,n.default=u,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
